---
description: 🚨 异常分析与避坑准则自动晋升工作流 (强制执行)
---

# 🔴 异常分析与记录工作流 (MANDATORY - Analyze Error Workflow)

> **⚠️ 绝对优先级**: 本工作流为 **Step 0 级别强制令**，优先级高于任何代码修复动作。

---

## ✅ Step 0.1: 异常识别 (STOP & IDENTIFY)

**[强制要求]** 在开始**任何**编码修复之前，**必须先**执行以下步骤：

1. **立即停止**所有代码修改动作
2. 扫描错误信息中的关键字：`Exception`, `Error`, `StackTrace`, `══╡ EXCEPTION CAUGHT BY`, `failed`, `rejected`, `isn't defined`, `can't be assigned` 等
3. 提取异常的**核心类型**和**发生上下文**（忽略具体的内存地址或动态数值）

**[自检问题]**: "我是否已经停下来识别错误，而不是直接开始修复？"

---

## ✅ Step 0.2: 模式匹配与记录 (READ & RECORD)

**[绝对优先]** 更新 `exception_history.md` 的优先级**高于编写任何代码**。

### 强制执行步骤：

```
1. 使用 view_file 读取 `exception_history.md`
2. 判断当前异常是否为已知模式（匹配核心错误类型）
3. 执行更新操作：
   - 如果是新异常 → 新增记录，计数 = 1
   - 如果是重复异常 → 更新"最后发生时间"，计数 + 1
4. 检查计数是否达到 3
```

**[禁止行为]**: 跳过记录步骤直接修复代码

---

## ✅ Step 0.3: 规则晋升检查 (PROMOTE IF NEEDED)

**[自动触发条件]** 如果某个异常的计数达到 **3**：

1. **[强制动作]** 将该异常提炼为一条具体的、可操作的开发规则
2. **[强制动作]** 将此规则添加到 `prevention_rules.md`
3. **[强制汇报]** 向用户明确汇报：
   ```
   🚨 高频错误警告：
   - 错误类型：[具体错误]
   - 发生次数：3次
   - 已自动晋升到避坑指南
   - 后续开发将强制规避此错误
   ```

---

## ✅ Step 0.4: 完成确认后才允许修复

**[检查清单]** 在开始修复代码前，AI 必须确认：

- [ ] 我已经读取了 `exception_history.md`
- [ ] 我已经更新了错误记录
- [ ] 我已经检查了是否需要晋升规则
- [ ] 我已经完成了所有 Step 0 步骤

**[执行令]** 只有当上述所有复选框都被勾选后，才允许开始编写修复代码。

---

## 🎯 显性调用指令

- 用户输入 `/analyze-error [内容]` 时，**强制执行**上述所有步骤
- AI 在看到任何错误信息时，**自动触发**本工作流

---

## ⚠️ 违规后果

如果 AI 跳过 Step 0 直接修复代码：
1. 视为**严重执行违规**
2. 用户有权要求回滚并重新执行
3. AI 必须补充执行所有遗漏的 Step 0 步骤
